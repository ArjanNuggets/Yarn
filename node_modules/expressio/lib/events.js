'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _isString = require('lodash/isString');

var _isString2 = _interopRequireDefault(_isString);

var _isFunction = require('lodash/isFunction');

var _isFunction2 = _interopRequireDefault(_isFunction);

var _ndtk = require('ndtk');

var _ndtk2 = _interopRequireDefault(_ndtk);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = server => {
  const stack = {};

  /**
   * Register to new events
   */
  const on = (event, fn) => {
    _ndtk2.default.assert((0, _isString2.default)(event) && event.length !== 0, 'Events error: event is not a string');
    _ndtk2.default.assert((0, _isFunction2.default)(fn), `Events error: "${event}" event has not a valid function`);

    if (!stack[event]) stack[event] = [fn];else stack[event] = [...stack[event], fn];
  };

  /**
   * Emit new events
   *
   * The first argument is always the server instance
   */
  const emit = (event, ...args) => {
    _ndtk2.default.assert((0, _isString2.default)(event) && event.length !== 0, 'Events error: event is not a string');

    const events = stack[event] || [];
    return Promise.all(events.map(fn => fn(server, ...args)));
  };

  // Expose JWT Api to the server object
  server.events = { on, emit };
}; /**
    * Events
    *
    * @copyright Copyright (c) 2018, hugw.io
    * @author Hugo W - contact@hugw.io
    * @license MIT
    */
//# sourceMappingURL=events.js.map